# 模拟交易所

该项目模拟了一个简易的交易所系统，支持客户端通过限价单和市价单进行交易。服务器维护订单簿并处理撮合逻辑，客户端可连接服务器发送订单并接收反馈。

---

## 功能特性
- **订单类型支持**  
  - 不限时限价单（Limit Order）
  - 立即执行市价单（Instant Market Order）
  - 预留接口：限时限价单（Timed Limit Order）、持续市价单（Lasting Market Order）
- **实时撮合引擎**  
  自动匹配买卖订单，支持价格优先、时间优先规则。
- **监控功能**  
  客户端可启动监控线程，接收服务器交易动态（代码中暂未实现输出）。
- **用户认证**  
  基于用户名和密码登录，支持动态生成客户端密钥。

---

## 环境要求
- Python 3.7+
- 依赖库：`numpy`、`argparse`、`getpass`
- 文件依赖：确保包含 `utils.py`（内含 `encrypt` 和 `decrypt` 加解密函数以及 `load_users_from_json` 用户文件处理函数）

---

## 快速开始

### 1. 启动服务器
```bash
python server_run.py
```
- 服务器默认监听 `127.0.0.1:12345`
- 合法用户信息从 `users.json` 加载（示例已包含用户 `cat:123` 和 `cat2:123`）

### 2. 启动客户端
在新终端中输入
```bash
python client_run.py -u <用户名>  # 示例：python client_run.py -u cat
```
- 根据提示输入密码（或通过 `-p` 参数直接指定，但出于安全考虑不推荐）
- 登录成功后，输入订单命令进行交易

---

## 订单命令格式

### 限价单（Limit Order）
```text
[买卖方向] [股票代码] [价格] [数量] [超时时间（可选）]
```
- **示例**  
  - `a AAA 100.5 500`       → 以单价 100.5 卖出 500 股 AAA
  - `b BBB 99.0 300 60`     → 以单价 99.0 买入 300 股 BBB，60 秒后超时（预留功能）

### 市价单（Market Order）
```text
[买卖方向] [订单类型] [股票代码] [数量]
```
- **参数说明**  
  - 订单类型：`I`（立即执行）、`L`（持续挂单，预留功能）
- **示例**  
  - `a I BBB 200` → 立即以市场最优价卖出 200 股 BBB，如果最优价格上不足 200 股则放弃剩余数量

---

## 订单簿查询
服务器每 1 秒输出当前最优买卖价（需观察服务器控制台）：
```text
AAA:99.0 -|- 100.5  # 表示 AAA 当前最高买价 99.0，最低卖价 100.5
```

---

## 注意事项
1. **用户配置**  
   修改 `users.json` 可添加/删除合法用户，格式需符合 JSON 规范。
2. **加密依赖**  
   需确保 `utils.py` 存在且实现 `encrypt` 和 `decrypt` 函数。
3. **价格精度**  
   价格最小单位为 0.01，最大允许 1000。
4. **合法交易标的**  
   仅支持 `AAA` 和 `BBB` 两种股票代码。

---

## 代码结构
```
├── client.py          # 客户端逻辑（登录、下单）
├── client_run.py      # 客户端启动脚本
├── server.py          # 服务器逻辑（订单簿、撮合引擎）
├── server_run.py      # 服务器启动脚本
├── users.json         # 合法用户配置
└── utils.py           # 工具函数
